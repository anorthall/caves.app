{% extends "_minimal.html" %}
{% load core_tags %}

{% block body %}
  <header>
    {% if user.is_authenticated %}
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary py-2" id="navbarContainer">
        <div class="container">
          <a class="navbar-brand fs-3" href="/">{{ site_title }}</a>
          <ul class="navbar-nav w-100 d-none d-lg-flex mx-5 w-100 {% if user.is_authenticated %}justify-content-center{% else %}justify-content-end{% endif %}" id="mainNavbar">
            {% include "_navbar_links.html" %}
          </ul>

          {% if user.is_authenticated %}
            <div class="d-flex flex-row justify-content-center align-items-center order-0 ms-auto me-2">
              {% if user.has_mod_perms %}
                <div class="me-3">
                  <a href="{% url 'staff:index' %}" class="nav-link text-white">
                    <i class="bi bi-gear-fill"></i>
                  </a>
                </div>
              {% endif %}

              <div class="me-3">
                <a href="{% url 'users:account_detail' %}" class="nav-link text-white">
                  {% if user.avatar %}
                    <img src="{{ user.avatar|imgproxy:"preset:avatar_navbar" }}" width="25" height="25" class="rounded-circle border border-dark" alt="User avatar">
                  {% else %}
                    <i class="bi bi-person-circle"></i>
                  {% endif %}
                </a>
              </div>

              <div x-data="{ open: false }">
                <a class="nav-link" href="#">
                  <span class="icon-badge-container text-white" x-on:click="open = !open">
                    {% if notifications.unread %}
                      <i class="bi bi-bell-fill icon-badge-icon"></i>
                      <span class="icon-badge">{{ notifications.unread }}</span>
                    {% else %}
                      <i class="bi bi-bell"></i>
                    {% endif %}
                  </span>
                </a>
                <div class="notification-dropdown shadow-lg border border-2 bg-light" x-show="open" x-transition>
                  <div class="item title my-0">
                    Notifications
                  </div>

                  {% if notifications.list %}
                    {% for notification in notifications.list %}
                      <div data-href="{% url 'users:notification' pk=notification.pk %}" class="item text-primary">
                        <span{% if not notification.read %} class="fw-bold"{% endif %}>{{ notification.message }}</span>
                        <br />
                        <small class="text-muted">
                          {{ notification.added|timesince }} ago
                        </small>
                      </div>
                    {% endfor %}

                    <div data-href="{% url 'users:notifications' %}" class="item text-primary">
                      <a href="{% url 'users:notifications' %}"
                         class="btn btn-primary">
                        See all notifications
                      </a>
                    </div>
                  {% else %}
                    <div class="item title fw-normal text-primary">
                      <span>You do not have any notifications. Oh well!</span>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endif %}
        </div>
        <div class="container d-flex flex-row justify-content-center d-lg-none" id="navbarMobileMenu">
          <ul class="d-flex flex-row justify-content-between w-100 px-0">
            {% include "_navbar_links.html" %}
          </ul>
        </div>
      </nav>
    {% else %}
      <nav class="navbar navbar-expand-sm navbar-dark bg-primary py-2" id="unregisteredNavbarContainer">
        <div class="container d-flex justify-content-between">
          <a class="navbar-brand fs-3" href="/">{% if debug %}devel.app{% else %}caves.app{% endif %}</a>
          <a class="nav-link text-white text-decoration-none" href="{% url 'users:login' %}">Login</a>
        </div>
      </nav>
    {% endif %}

    <!-- Page display title -->
    <div class="bg-light border-top border-bottom border-2 py-4">
      <div class="container {% block display_title_container_class %}d-flex flex-column flex-lg-row justify-content-between align-items-center{% endblock %}">
        <h1 class="{% block display_title_class %}fs-3 m-0 text-center{% endblock %}">{% block display_title %}caves.app{% endblock %}</h1>

        <div class="d-flex align-items-center justify-content-center">
          <div class="text-muted fs-5">
            {% block display_title_right %}{% endblock %}
          </div>
        </div>
      </div>
    </div>

    {% block mobile_menu_container %}
      <!-- Mobile top level menu -->
      <div id="mobileMenuContainer" class="d-lg-none border-bottom border-primary py-3">
        <div class="container">
          <nav id="mobileMenu" class="nav nav-light nav-pills d-flex flex-row justify-content-center">
            {% block mobile_menu %}{% endblock %}
          </nav>
        </div>
      </div>
    {% endblock %}

    <!-- Messages -->
    {% include "_messages.html" %}
  </header>

  <main class="d-flex flex-column flex-fill my-3 my-lg-4">
    <div class="{% block main_container_class %}container{% endblock %} flex-fill mb-4">
      {% block content %}{% endblock %}
    </div>
  </main>

  <footer class="footer mt-auto py-3 border-top bg-primary text-white">
    <div class="container">
      {% include "_footer.html" %}
    </div>
  </footer>
{% endblock body %}
