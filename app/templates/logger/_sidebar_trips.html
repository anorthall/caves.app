{% load active_link_tags %}

{% if trip %}
  <div class="mb-5 d-none d-lg-block">
    {% if trip.user.avatar %}
      {% include "users/_profile_picture.html" with photo_user=trip.user %}
    {% else %}
      {% include "users/_profile_picture.html" %}
    {% endif %}
  </div>
{% endif %}

{% if user.is_authenticated %}
  {% comment %} Authenticated user links {% endcomment %}
  <span class="nav-item sidebar-header d-none d-lg-block">Trips</span>

  <a class="nav-link {% active_link 'log:index' %}" href="{% url 'log:index' %}">
    <i class="bi bi-people-fill"></i> Recent
  </a>

  <a class="nav-link {% active_link 'log:search' %} {% active_link 'log:search_results' %}" href="{% url 'log:search' %}">
    <i class="bi bi-search"></i> Search
  </a>

  <a class="nav-link" href="{% url 'maps:index' %}">
    <i class="bi bi-map"></i> Maps
  </a>
{% endif %}

{% if trip and user == object_owner %}
  {% comment %} Viewing a trip as the owner of it {% endcomment %}
  <span class="nav-item sidebar-header d-none d-lg-block mt-4">This trip</span>
  <a class="nav-link {% active_link 'log:trip_detail' uuid=trip.uuid %}" href="{{ trip.get_absolute_url }}">
    <i class="bi bi-info-circle"></i> View trip
  </a>

  <a class="nav-link {% active_link 'log:trip_update' uuid=trip.uuid %}" href="{% url 'log:trip_update' trip.uuid %}">
    <i class="bi bi-pencil"></i> Edit trip
  </a>

  <a class="nav-link" data-bs-toggle="modal" data-bs-target="#deleteTripModal">
    <i class="bi bi-x-lg"></i> Delete trip
  </a>

  <a class="nav-link {% active_link 'log:trip_photos' uuid=trip.uuid %}" href="{% url 'log:trip_photos' trip.uuid %}">
    <i class="bi bi-images"></i> Photos
  </a>

  <span class="nav-item sidebar-header d-none d-lg-block mt-4">Report</span>
  {% if trip.report %}
    <a class="nav-link {% active_link 'log:report_detail' uuid=trip.uuid %}" href="{{ trip.report.get_absolute_url }}">
      <i class="bi bi-card-text"></i> View trip report
    </a>

    <a class="nav-link {% active_link 'log:report_update' uuid=trip.uuid %}" href="{% url 'log:report_update' trip.uuid %}">
      <i class="bi bi-pencil"></i> Edit trip report
    </a>

    <a class="nav-link" data-bs-toggle="modal" data-bs-target="#deleteTripReportModal">
      <i class="bi bi-x-lg"></i> Delete trip report
    </a>
  {% else %}
    <a class="nav-link {% active_link 'log:report_create' uuid=trip.uuid %}" href="{% url 'log:report_create' trip.uuid %}">
      <i class="bi bi-card-text"></i> Add trip report
    </a>
  {% endif %}

{% elif trip and user != object_owner %}
  {% comment %}Viewing a trip but not the owner of it{% endcomment %}

  <span class="nav-item sidebar-header d-none d-lg-block mt-4">{{ object_owner.username }}</span>
  {% if can_view_profile %}
    <a class="nav-link" href="{% url 'log:user' username=object_owner.username %}">
      <i class="bi bi-person-fill"></i> User profile
    </a>
  {% endif %}

  <a class="nav-link {% active_link 'log:trip_detail' uuid=trip.uuid %}" href="{{ trip.get_absolute_url }}">
    <i class="bi bi-card-text"></i> View trip
  </a>

  {% if can_view_report %}
    <a class="nav-link {% active_link 'log:report_detail' uuid=trip.uuid %}" href="{{ trip.report.get_absolute_url }}">
      <i class="bi bi-card-text"></i> View trip report
    </a>
  {% endif %}

  {% if can_add_friend and user.is_authenticated %}
    <a class="nav-link" href="{% url 'users:friends' %}?u={{ object_owner.username }}">
      <i class="bi bi-plus-lg"></i> Add as friend
    </a>
  {% endif %}
{% endif %}


<span class="nav-item sidebar-header d-none d-lg-block mt-4">caves.app</span>
{% if user.is_anonymous %}
  <a class="nav-link" href="{% url 'users:login' %}">
    <i class="bi bi-person-circle"></i> Sign in
  </a>

  <a class="nav-link" href="{% url 'users:register' %}">
    <i class="bi bi-house"></i> Register
  </a>
{% endif %}

<a class="nav-link{% if trip %} d-none d-lg-block{% endif %} {% active_link 'core:news' %}" href="{% url 'core:news' %}">
  <i class="bi bi-newspaper"></i> News
</a>

<a class="nav-link{% if trip %} d-none d-lg-block{% endif %} {% active_link 'core:help' %}" href="{% url 'core:help' %}">
  <i class="bi bi-question-circle"></i> Help
</a>
