{% extends "base_sidebar.html" %}
{% load markdownify %}

{% block title %}{{ page_title }}{% endblock %}
{% block meta_tags %}<meta name="author" content="{{ profile_user.name }}">{% endblock %}

{% block display_title %}{{ page_title }}{% endblock %}
{% block display_title_right %}@{{ profile_user.username }}{% endblock %}
{% if private_profile %}
  {% block display_title_container %}{% endblock %}
{% endif %}

{% block description %}{{ profile_user.name }}'s trips on caves.app.{% endblock %}

{% block sidebar %}{% include "logger/_sidebar_profile.html" %}{% endblock %}
{% block mobile_menu %}{% include "logger/_sidebar_profile.html" %}{% endblock %}

{% block main %}
  {% if not private_profile %}
    {% if user_has_trips %}
      <div class="form-floating mb-4">
        <input type="text" class="form-control border-primary" id="searchInput" placeholder="Search"
               hx-get="{% url 'log:profile_trips_table' profile_user.username %}"
               hx-trigger="keyup changed delay:100ms"
               hx-target="#userTrips"
               hx-replace="outerHTML"
               autocomplete="off"
               name="query">
        <label for="floatingInput">Search</label>
      </div>
    {% endif %}

    {% if profile_user.bio %}
      <div class="mb-4">
        {{ profile_user.bio|markdownify }}
      </div>
    {% elif not profile_user.bio and not trips %}
      <p class="lead mb-4">
        There is nothing here &mdash; yet.
        {% if user == profile_user %}
          Why not <a href="{% url 'log:trip_create' %}">add a trip</a> or
          <a href="{% url 'users:profile_update' %}">update your profile</a>?
        {% endif %}
      </p>
    {% endif %}

    {% if stats %}
      <div class="profile-stats {% if profile_user.bio %}mt-4{% endif %} mb-3 border-top">
        {% include "stats/_yearly_stats.html" with stats=stats disable_survey=profile_user.disable_survey_statistics disable_dist=profile_user.disable_distance_statistics table_class="table-sm" dist_class="d-none d-md-table-cell" %}
      </div>
    {% endif %}

    {% if user_has_trips %}
      <div id="userTrips" hx-get="{% url 'log:profile_trips_table' profile_user.username %}" hx-trigger="load" hx-swap="outerHTML"></div>
    {% endif %}

  {% else %}
    <div class="card bg-info-subtle text-center">
      <div class="card-body">
        <h4 class="card-title">
          <i class="bi bi-exclamation-triangle-fill me-1"></i>
          You do not have permission to view this profile
        </h4>

        <p class="mt-3 mb-0">{{ profile_user.name }}'s privacy settings do not permit it. Sorry about that! &#128532;</p>
      </div>
    </div>
  {% endif %}
{% endblock %}
