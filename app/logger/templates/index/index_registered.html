{% extends "base_full_width.html" %}
{% load user %}
{% load distformat %}
{% load humanize %}
{% block main %}

<div class="row">
  <div class="col-12 col-lg-9 col-xl-8">
    {% for trip in trips %}
      <div class="card shadow mb-4">
        <div class="card-header">
          {% include "includes/trip_header_small.html" %}
        </div>

        <div class="card-body">
          <div class="row row-cols-2 g-3">
            <div class="col">
              <small class="text-muted">Start</small><br />
              {{ trip.start|naturalday:"D, jS M y"|capfirst }}, {{ trip.start|time:"g:i a" }}
            </div>

            <div class="col">
              <small class="text-muted">Type</small><br />
              {{ trip.type }}<br />
            </div>

            {% if trip.end %}
              <div class="col">
                <small class="text-muted">End</small><br />
                {{ trip.end|naturalday:"D, jS M y"|capfirst }}, {{ trip.end|time:"g:i a" }}
              </div>

              <div class="col">
                <small class="text-muted">Duration</small><br />
                {{ trip.duration_str }}<br />
              </div>
            {% endif %}
          </div>

          {% if trip.cavers or trip.clubs or trip.expedition %}
            <hr>

            <div class="row row-cols-2 g-3">
              {% if trip.cavers %}
                <div class="col">
                  <small class="text-muted">Cavers</small><br />
                  {{ trip.cavers }}
                </div>
              {% endif %}

              {% if trip.clubs or trip.expedition %}
                <div class="col">
                  {% if trip.clubs and trip.expedition %}
                    <small class="text-muted">Organisations</small><br />
                    {{ trip.expedition }}</span>, {{ trip.clubs }}<br />
                  {% elif trip.clubs %}
                    <small class="text-muted">Clubs</small><br />
                    {{ trip.clubs }}
                  {% elif trip.expedition %}
                    <small class="text-muted">Expedition</small><br />
                    {{ trip.expedition }}
                  {% endif %}
                </div>
              {% endif %}
            </div>
          {% endif %}

          {% if trip.has_distances %}
            <hr>

            <div class="row row-cols-2 g-3">
              {% for name, distance in trip.distances.items %}
                <div class="col">
                  <small class="text-muted">{{ name|capfirst }}</small><br />
                  {{ distance|distformat:request.user.settings.units }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <div class="card-footer">
          <span class="float-start">
            {% with trip.likes_count as likes_count %}
              {% include "includes/htmx_trip_like.html" %}
            {% endwith %}
          </span>

          {% if trip.user.settings.allow_comments %}
            <span hx-get="{% url 'log:htmx_trip_comment' trip.pk %}" hx-target="#comment{{ forloop.counter }}" class="float-end">
              <span class="text-primary"><i class="bi bi-chat-fill"></i></span>&nbsp; {{ trip.comments_count }}<span class="d-none d-md-inline"> comment{{ trip.comments_count|pluralize }}</span>
            </span>
          {% endif %}
        </div>
      </div>

      <div class="shadow mb-4" id="comment{{ forloop.counter }}"></div>
    {% endfor %}
  </div>

  <div class="col-12 col-lg-3 col-xl-4">
    <div class="shadow">
      {% include "includes/news.html" %}
    </div>
  </div>
</div>

{% endblock main %}
