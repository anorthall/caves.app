{% extends "sidebar_base.html" %}
{% load active_link_tags %}

{% block sidebar_title %}
  {% if user == object_owner %}
    Your trip
  {% else %}
    Trip by {{ object_owner.name }}
  {% endif %}
{% endblock %}

{% block sidebar_nav %}
  {% if user == object_owner %}
    <a class="nav-link {% active_link 'log:user' username=object_owner.username %}" href="{% url 'log:user' username=object_owner.username %}">
      <i class="bi bi-card-list"></i>&nbsp; Your trips
    </a>

    <hr class="m-2">

    <a class="nav-link {% active_link 'log:trip_detail' pk=trip.pk %}" href="{% url 'log:trip_detail' pk=trip.pk %}">
      <i class="bi bi-info-circle"></i>&nbsp; View trip
    </a>

    <a class="nav-link {% active_link 'log:trip_update' pk=trip.pk %}" href="{% url 'log:trip_update' pk=trip.pk %}">
      <i class="bi bi-pencil"></i>&nbsp; Edit trip
    </a>

    <a class="nav-link" data-bs-toggle="modal" data-bs-target="#deleteTripModal">
      <i class="bi bi-x-lg"></i>&nbsp; Delete trip
    </a>

    {% if trip.report %}
      <hr class="m-2">
      <a class="nav-link {% active_link 'log:report_detail' pk=trip.report.pk %}" href="{% url 'log:report_detail' pk=trip.report.pk %}">
        <i class="bi bi-card-text"></i>&nbsp; View trip report
      </a>

      <a class="nav-link {% active_link 'log:report_update' pk=trip.report.pk %}" href="{% url 'log:report_update' pk=trip.report.pk %}">
        <i class="bi bi-pencil"></i>&nbsp; Edit trip report
      </a>

      <a class="nav-link" data-bs-toggle="modal" data-bs-target="#deleteTripReportModal">
        <i class="bi bi-x-lg"></i>&nbsp; Delete trip report
      </a>
    {% else %}
      <hr class="m-2">
      <a class="nav-link {% active_link 'log:report_create' pk=trip.pk %}" href="{% url 'log:report_create' pk=trip.pk %}">
        <i class="bi bi-card-text"></i>&nbsp; Add trip report
      </a>
    {% endif %}
  {% else %}
    {% if can_view_profile %}
      <a class="nav-link" href="{% url 'log:user' username=object_owner.username %}">
        <i class="bi bi-card-list"></i>&nbsp; View profile
      </a>
    {% endif %}

    <a class="nav-link {% active_link 'log:trip_detail' pk=trip.pk %}" href="{% url 'log:trip_detail' pk=trip.pk %}">
      <i class="bi bi-info-circle"></i>&nbsp; View this trip
    </a>

    {% if can_add_friend and user.is_authenticated %}
      <a class="nav-link" href="{% url 'users:friends' %}?u={{ object_owner.username }}">
        <i class="bi bi-plus-lg"></i>&nbsp; Add as friend
      </a>
    {% endif %}

    {% if can_view_report %}
      <a class="nav-link {% active_link 'log:report_detail' pk=trip.report.pk %}" href="{% url 'log:report_detail' pk=trip.report.pk %}">
        <i class="bi bi-card-text"></i>&nbsp; View trip report
      </a>
    {% endif %}
  {% endif %}

  {% if user == object_owner %}
    <div class="modal fade" id="deleteTripModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5">Delete trip</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete the trip to {{ trip.cave_name }} on
            {{ trip.start|date }}? This action is permanent and cannot be undone.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <form action="{% url 'log:trip_delete' pk=trip.pk %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger">Delete trip</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    {% if trip.report %}
      <div class="modal fade" id="deleteTripReportModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5">Delete trip report</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete the trip report for the trip to {{ trip.cave_name }} on
              {{ trip.start|date }}? This action is permanent and cannot be undone.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <form action="{% url 'log:report_delete' pk=trip.report.pk %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Delete trip report</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endblock %}
