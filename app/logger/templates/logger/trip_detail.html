{% extends "base_sidebar.html" %}
{% load distformat %}
{% block title %}{{ trip.cave_name }}{% endblock %}
{% block sidebar %}{% include "includes/sidebar_trips.html" %}{% endblock %}

{% block main %}
<div class="card">
  <div class="card-header mb-2">
    {% include "includes/trip_header.html" %}
  </div>

  <div class="card-body pt-2">
    <!-- Data blocks -->
    <div class="row row-cols-2 row-cols-md-3 g-3">
      <!-- Start time-->
      <div class="col">
        <small class="text-muted">Date/time entered</small><br />
        {{ trip.start|time:"H:i" }} on {{ trip.start|date:"d M Y" }}
      </div>

      {% if trip.end %}
        <!-- Duration -->
        <div class="col">
          <small class="text-muted">Trip duration</small><br />
          {{ trip.duration_str }}
        </div>

        <!-- End time -->
        <div class="col">
          <small class="text-muted">Date/time exited</small><br />
          {{ trip.end|time:"H:i" }} on {{ trip.end|date:"d M Y" }}
        </div>
      {% endif %}
    </div>

    {% if trip.cavers or trip.clubs or trip.expedition %}
      <hr />
      <div class="row g-3">
        {% if trip.cavers %}
          <!-- Cavers -->
          <div class="col-12 col-lg-6 col-xl-4">
            <small class="text-muted">Cavers on trip</small><br />
            {{ trip.cavers }}
          </div>
        {% endif %}

        {% if trip.clubs %}
          <!-- Clubs -->
          <div class="col-6 col-xl-4">
            <small class="text-muted">Clubs</small><br />
            {{ trip.clubs }}
          </div>
        {% endif %}

        {% if trip.expedition %}
          <!-- Expedition -->
          <div class="col-6 col-xl-4">
            <small class="text-muted">Expedition</small><br />
            {{ trip.expedition }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    {% if trip.has_distances %}
      <hr />

      <div class="row row-cols-2 row-cols-md-3 g-3">
        {% for name, dist in trip.distances.items %}
          <div class="col">
            <small class="text-muted">{{ name|capfirst }}</small><br />
            {{ dist|distformat:request.user.settings.units }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if trip.notes %}
      <hr />

      <!-- Notes -->
      <div class="row g-3">
        <div class="col notes-display">
          <small class="text-muted">Notes</small><br />
          {{ trip.notes|linebreaks }}
        </div>
      </div>
    {% endif %}

    {% if trip.cave_url %}
      <hr />

      <!-- External Resources -->
      <div class="row g-3">
        <div class="col">
          <small class="text-muted">External resources</small>
          <ol class="mb-0">
            {% if trip.cave_url %}<li><a href="{{ trip.cave_url }}">Website for {{ trip.cave_name }}</a></li>{% endif %}
          </ol>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="card-footer">
    <span class="float-start">
      {% if request.user.is_authenticated %}
        {% include "includes/htmx_trip_like.html" %}
      {% else %}
        <i class="bi bi-hand-thumbs-up-fill"></i>
        {{ trip.likes }} like{{ trip.likes|pluralize }}
      {% endif %}
    </span>

    {% if user.settings.allow_comments %}
      <span class="float-end">
          <span class="text-primary"><i class="bi bi-chat-fill"></i></span>&nbsp; {{ trip.comments_count }} comment{{ trip.comments_count|pluralize }}
      </span>
    {% endif %}
  </div>
</div>

{% with trip as object %}
  <div class="mt-4"></div>
  {% include "includes/comments.html" %}
{% endwith %}

{% endblock main %}
